<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>nArray 前端数据管理工具</title>
		<!-- <script src="./narray.min-0.4.js"></script> -->
		<script src="./narray-0.4.js"></script>
	</head>
	<body>
		<script>

			/*
				性能声明：此功能是原生map循环的5、6倍时长；是原生for循环40倍；

				0.5 改动：

				1、将着重针对性能进行优化；

				2、部分方法无法使用，例如 update；

				3、兼容性处理机制差；


			*/


			for ( var i=0; i<3; i++ ) {
				console.log('i', i);
                for ( var j=0; j<3; j++ ) {
					console.log('j', j);
					break;
                }
				break;
            }


			var names = [
				{
					id: 1,
					text: '人人为我,我为人人.',
					name: {
						en: 'Dumas pere',
						zh: '大仲马'
					}
				},
				{
					id: 2,
					text: '手中的一只鸟胜于林中的两只鸟.',
					name: {
						en: 'Heywood',
						zh: '希伍德'
					}
				},
				{
					id: 3,
					text: '易得者亦易失.',
					country: '[美]',
					name: {
						en: 'Hazlitt',
						zh: '赫斯特'
					}
				},
				{
					id: 4,
					text: '时间就是金钱.',
					country: '[美]',
					name: {
						en: 'Benjamin Franklin',
						zh: '富兰克林 '
					}
				},
				{
					id: 5,
					text: '伟大的人物总是愿意当小人物的.',
					name: {
						en: 'R. W. Emerson',
						zh: '爱默生'
					}
				}
			];

			// 测试：深度查询（$path属性）
			var a1 = [
					{
						b1: {
							c1: {
								d1: {
									e1: {
										f1: 'afasdqw',
										f2: '1231',
										f3: '999999999',
										f4: 11,
										f5: 'a'
									}
								},
								d2: 'a',
								d3: 'b',
								d4: 'c'
							},
							c2: 'c',
							c3: [1,2,3,4],
							c4: [
								{
									d4: 11,
									d5: 22
								},
								{
									d6: 33
								},
								{
									d7: [111,222,333]
								},
								{
									d8: 'a',
									d9: ['b', 'c']
								}
							]
						},
						b2: '111',
						b3: 1
					}
				];

			// 测试：详细查询、严格详细查询
			var t04_1 = [{name: null, sn: 't01'}, {name: undefined, sn: 't02'}, {name: 1, sn: 't03'}, {name: '1', sn: 't04'}, {name: true, sn: 't05'}, {name: false, sn: 't06'}, {name: '', sn: 't07'} ];



			// 测试（test02）：特殊字符、不同类型值的快速（字符串）查询
			var t2 = [ {k:0, v:'aaa'},{k:1, v:'bbbb'}, {k:2, v: ''}, {k:2, v: null}, {k:'2', v: undefined}, {k:3, v: true}, {k:'3', v: 'true'} ];

			// t2.$get();		->	获取所有含空置的对象数据

			// t2.$search();	=>	t2.$search('*') 	=>	获取全部对象数据集合

			// t2.$get({});

			// t2.$get(2);

			// t2.$get(true);


			var t3 = [{"has_refri_economizer":0,"t_evap_idx":null,"type_stage_comp":0,"num_comp":"1","num_wp_wc_oc":0,"num_wt_wc_oc":0,"has_gas_liquid_separator":0,"comp":[],"watertower":[],"waterpump":[],"has_comprack":0,"num_comprack":0,"comprack":[]}];

			for ( var j=0; j<1000; j++ ) {
				t3[0].comp.push({"type_comp":j,"has_economizer":0,"t_middle":null,"p_middle":null,"type_oc":0,"has_process_cooler":1,"t_evap_idx_pc":null});
			}


			function go(){


				// na 速度
				var start, end;


				console.log('原生 for------------------------------');

				console.log(start = new Date().getTime());

				for ( var i=0; i<t3.comp.length; i++ ) {
					t3.comp[i].has_process_cooler = Math.random() * i;
				}

				console.log(end = new Date().getTime(), end - start);
				console.log('用时ms:' + ( end - start ));


				console.log('封装 for------------------------------');

				function useFor ( datas, callback ) {
					if ( datas.constructor == Array ) {
						for ( var i=0; i<datas.length; i++ )
							if ( callback( datas[i], i ) )
								break;
					}
					else {
						for ( var key in datas )
							if ( callback( datas[key], key ) )
								break;
					}
				}

				console.log(start = new Date().getTime());

				useFor(t3.comp, function( data, index ){
					if ( index > 10000 )
						return true;
					data.has_process_cooler = Math.random() * index;
				});

				console.log(end = new Date().getTime(), end - start);
				console.log('用时ms:' + ( end - start ));


				console.log('原生 map------------------------------');

				console.log(start = new Date().getTime());

				t3.comp.map(function( data, index ){
					data.has_process_cooler = Math.random() * index;
				});

				console.log(end = new Date().getTime(), end - start);
				console.log('用时ms:' + ( end - start ));


				console.log('na------------------------------');

				console.log(start = new Date().getTime());

				t3.comp.$search('has_process_cooler=*').$update('has_process_cooler=2');

				console.log(end = new Date().getTime());
				console.log('用时ms:' + ( end - start ));


				console.log(t3.comp);

			}


			// 查看指定系统
			// start = new Date().getTime();
			// var ttt = [t4].$get('parameter_id=3144');
			// end = new Date().getTime();

			// console.log('用时ms:' + ( end - start ), ttt.length, ttt);


			goTime(function(){
				console.log(t3.$get('type_comp=1'), t3);
			}, '10个值的计算');

			goTime(function(){
				console.log( t4.$get('parameter_id=3144').$update({signal_type: 1}) );
			});


			// 获取执行时长
			function goTime( callback, msg ){
				console.log('-----------------', msg || '')
				var start = new Date().getTime();
				callback();
				var end = new Date().getTime();
				console.log('用时ms:' + ( end - start ));
			}

		</script>
	</body>
</html>