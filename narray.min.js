//! nArray.js
//! version : 0.5/5/20160616
//! author : Na Chao
//! license : FFF
//! github.com/nachao/nArray
!function(a,b){"use strict";b(a)}(Array.prototype,function(array,undefined){"use strict";function NArray(){}function each(a,b){var e,f,d=[];for(f in a){if(NArray.log.cycles+=1,a.hasOwnProperty(f)&&d.indexOf(a[f])<0&&(e=b(f,a[f])))break;"object"==typeof a[f]&&d.push(a[f])}return!!e}NArray.fn=NArray.prototype={},NArray.version=.1/20160616,NArray.log={cycles:0};var caseSign=["<=",">=","<",">","!=","==","="];Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c,d,e,f;if(null==this)throw new TypeError('"this" is null or not defined');if(d=Object(this),e=d.length>>>0,0===e)return-1;if(f=+b||0,1/0===Math.abs(f)&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);e>c;){if(c in d&&d[c]===a)return c;c++}return-1}),Object.keys||(Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on a non-object");var c,b=[];for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),function(){if(!Object.defineProperty||!function(){try{return Object.defineProperty({},"x",{}),!0}catch(a){return!1}}()){var a=Object.defineProperty;Object.defineProperty=function(b,c,d){if(a)try{return a(b,prop,d)}catch(e){}if(b!==Object(b))throw TypeError("Object.defineProperty called on non-object");return Object.prototype.__defineGetter__&&"get"in d&&Object.prototype.__defineGetter__.call(b,prop,d.get),Object.prototype.__defineSetter__&&"set"in d&&Object.prototype.__defineSetter__.call(b,prop,d.set),"value"in d&&(b[prop]=d.value),b}}}(),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(a){var c,d,e,f,g,h,i,j;if(a===undefined||null===a)throw new TypeError("Cannot convert first argument to object");for(c=Object(a),d=1;d<arguments.length;d++)if(e=arguments[d],e!==undefined&&null!==e)for(f=Object.keys(Object(e)),g=0,h=f.length;h>g;g++)i=f[g],j=Object.getOwnPropertyDescriptor(e,i),j!==undefined&&j.enumerable&&(c[i]=e[i]);return c}}),NArray.extend=NArray.fn.extend=function(a,b){return b||(b=a,a=this),each(b,function(b,c){Object.defineProperty(a,b,{configurable:!0,enumerable:a.propertyIsEnumerable(b),writable:!0,value:c})}),a},NArray.extend({update:function(a,b){return"undefined"!=typeof b&&a.constructor===Array&&each(a,function(c,d){"object"==typeof b?Object.assign(d,b):"function"==typeof b&&b.call(d,a.$path[c])&&Object.assign(d,b.call(d,a.$path[c]))}),a},unique:function(a){var b=[];return each(a,function(a,c){b.indexOf(c)<0&&b.push(c)}),b},getInquiry:function(a){var b=new RegExp(caseSign.join("|"));return b.exec(a)?b.exec(a)[0]:"=="},setSpecialValue:function(a){var b="";return null!==a&&a!==undefined&&(b=a.toString().toLocaleLowerCase()),b},eachCondition:function(a){var b=[],c=[];return a.value&&"string"==typeof a.value?c=a.value.split("|"):a.value&&a.value.constructor==Array||(c=[a.value]),each(c,function(c,d){var e={key:a.key||"",val:d,mode:a.mode||"==",enable:"boolean"==typeof a.enable?a.enable:!0,strict:a.strict||!1};"*"==e.key&&(e.key=""),"*"==e.val&&(e.val=""),"string"==typeof e.key&&(e.key=e.key.trim()),"string"==typeof e.val&&(e.val=e.val.trim()),e.strict||(e.val=e.val||""),b.push(e)}),b},parseByString:function(a){var b=[],c=a?a.toString().split(","):[""];return each(c,function(a,c){var d=NArray.getInquiry(c),e=c.split(d),f={key:e[0],value:e[1],mode:d};"undefined"==typeof f.value&&(f.value=f.key||"",f.key=""),b=b.concat(NArray.eachCondition(f))}),b},parseByObject:function(a){var b=[],c=a;return c.constructor!==Array&&(c=[a]),each(c,function(a,c){b=b.concat(NArray.eachCondition(c))}),b},parseCondition:function(a){var b=[];return["string","boolean","number"].indexOf(typeof a)>=0||null===a||a===undefined?(a=NArray.setSpecialValue(a),b=NArray.parseByString(a)):(a.constructor==Array||a.constructor==Object)&&(b=NArray.parseByObject(a)),b},bindAttr:function(a,b,c){b[b.length-2]&&!a.$parent&&Object.defineProperty(a,"$parent",{value:b[b.length-2]}),c&&!a.$parentKey&&Object.defineProperty(a,"$parentKey",{value:c}),b[b.length-2]&&c&&!a.$parentGet&&Object.defineProperty(a,"$parentGet",{value:function(a){for(var b=this,c=null;b.$parent&&!c;)b=b.$parent,c=b[a];return c}})},mateEnter:function(a,b,c,d){var e=[];return d&&(c="whole "+c),a.constructor!=Array&&(a=[a]),Object.defineProperty(e,"$path",{value:[]}),NArray.log.cycles=0,b=NArray.parseCondition(b),a&&NArray.mateDepth(c,b,a,e),e},mateDepth:function(a,b,c,d,e,f,g){var h=Object.assign([],e),i=Object.assign([],f);c&&[Function,Object,Array].indexOf(c.constructor)>-1&&("undefined"!=typeof g&&i.push(g),h.push(c),NArray.bindAttr(c,h,g),NArray.mateCondition(a,c,b)&&(d.push(h[h.length-1]),d.$path.push({key:i,value:h})),each(c,function(c,e){"object"==typeof e&&NArray.mateDepth(a,b,e,d,h,i,c)}))},mateCondition:function(a,b,c){var d=!1,e=0;return each(c,function(f,g){if(g.key&&"object"==typeof b){if(g.key)return d=Object.keys(b).indexOf(g.key)>-1&&NArray.mateValues(b[g.key],g,a);each(b,function(b,c){return d=NArray.mateValues(c,g,a)})}else g.key||"object"!=typeof b?d=NArray.mateValues(b,g,a):each(b,function(b,c){return d=NArray.mateValues(c,g,a)});return d&&a.indexOf("whole")>=0&&(d=++e==c.length),d}),d},mateKeys:function(a,b,c){return b.key=b.key.toLocaleLowerCase(),a=String(a).toString().toLocaleLowerCase(),c.indexOf("get")>=0?a===b.key:a.indexOf(b.key)>=0},mateValues:function(value,cond,method){var result=!1;if(cond.strict?"search"==method&&(value=JSON.stringify(value)):(value=NArray.setSpecialValue(value),cond.val=NArray.setSpecialValue(cond.val)),!cond.enable)return result;if(["object","function"].indexOf(typeof value)>=0&&null!=value)return result;switch(cond.mode){case"=":case"==":result=method.indexOf("get")>=0?cond.strict?value===cond.val:value==cond.val:value.indexOf(cond.val)>=0;break;case"!=":result=method.indexOf("search")>=0?value.indexOf(cond.val)<0:value!==cond.val;break;default:result=eval('"'+value+'"'+cond.mode+'"'+cond.val+'"')}return result}}),NArray.extend(array,{$get:function(a,b){return NArray.mateEnter(this,a,"get",b)},$search:function(a,b){return NArray.mateEnter(this,a,"search",b)},$update:function(a){return NArray.update(this,a)}}),window&&(window.nArray=NArray)});