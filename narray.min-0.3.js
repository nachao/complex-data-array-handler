//! nArray.js
//! version : 0.3
//! author : Na Chao
//! license : FFF
//! github.com/nachao/nArray
!function(a,b){"use strict";b(a)}(Array.prototype,function(array,undefined){"use strict";function nArray(){}nArray.fn=nArray.prototype={};var caseSign=["<=",">=","<",">","!=","="];function each(a,b){var c,d;for(d in a)if(a.hasOwnProperty(d)&&(c=b(d,a[d])))break;return!!c}Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){var c,d,e,f;if(null==this)throw new TypeError('"this" is null or not defined');if(d=Object(this),e=d.length>>>0,0===e)return-1;if(f=+b||0,1/0===Math.abs(f)&&(f=0),f>=e)return-1;for(c=Math.max(f>=0?f:e-Math.abs(f),0);e>c;){if(c in d&&d[c]===a)return c;c++}return-1}),Object.keys||(Object.keys=function(a){if(a!==Object(a))throw new TypeError("Object.keys called on a non-object");var c,b=[];for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),nArray.extend=nArray.fn.extend=function(a,b){return b||(b=a,a=this),each(b,function(b,c){a[b]=c}),a},nArray.extend({update:function(a,b){return"undefined"!=typeof b&&a.constructor==Array&&each(a,function(c,d){"object"==typeof b?d=nArray.extend(d,b):"function"==typeof b&&b.call(d,a.$path[c])&&(d=nArray.extend(d,b.call(d,a.$path[c])))}),a},unique:function(a){var b=[];return each(a,function(a,c){b.indexOf(JSON.stringify(c))<0&&b.push(c)}),b},parseCondition:function(a){var b=[];return a=a?a.toString().split(","):[],each(a,function(a,c){var d=nArray.getInquiry(c),e=c.split(d),f=e[0],g=e[1];d||g||(g=f||"",f=""),b=b.concat(nArray.getCondition(f,g.split("|"),d))}),b},getInquiry:function(a){var b;return each(caseSign,function(c,d){return a.indexOf(d)>=0?(b=d,!0):void 0}),b},getCondition:function(a,b,c){var d=[];return b.constructor!=Array&&(b=[b]),each(b,function(b,e){d.push({key:"*"==a?"":a.trim(),val:"*"==e?"":e.trim(),mode:c||"="})}),d},mateEnter:function(a,b,c,d){var e=[];return d&&(c="whole "+c),a.constructor!=Array&&(a=[a]),e.constructor.prototype.$path=[],a&&nArray.mateDepth(c,b,a,e),e},mateDepth:function(a,b,c,d,e,f,g){var h=[],i=[];nArray.extend(i,f||[]),nArray.extend(h,e||[]),c&&[Function,Object,Array].indexOf(c.constructor)>-1&&("undefined"!=typeof g&&i.push(g),h.push(c),nArray.mateCondition(a,c,b)&&(d.push(h[h.length-1]),d.constructor.prototype.$path.push({key:i,value:h})),each(c,function(c,e){nArray.mateDepth(a,b,e,d,h,i,c)}))},mateCondition:function(a,b,c){var d=!1,e=0;return c=nArray.parseCondition(c),each(c,function(f,g){return g.key&&"object"==typeof b?each(b,function(b,c){return d=nArray.mateKeys(b,g,a)&&nArray.mateValues(c,g,a)}):g.key||"object"!=typeof b?d=nArray.mateValues(b,g,a):each(b,function(b,c){return d=nArray.mateValues(c,g,a)}),d&&a.indexOf("whole")>=0&&(d=++e==c.length),d}),d},mateKeys:function(a,b,c){return b.key=b.key.toLocaleLowerCase(),a=String(a).toString().toLocaleLowerCase(),c.indexOf("get")>=0?a===b.key:a.indexOf(b.key)>=0},mateValues:function(v,p,m){var r=!1,s=v?v.toString().toLocaleLowerCase():"",t=p.val.toString().toLocaleLowerCase();if(["object","function"].indexOf(typeof v)>=0)return r;switch(p.mode){case"=":r=m.indexOf("get")>=0?s===t:s.indexOf(t)>=0;break;case"!=":r=m.indexOf("search")>=0?s.indexOf(t)<0:s!==t;break;default:r=eval('"'+v+'"'+p.mode+'"'+p.val+'"')}return r}}),nArray.extend(array,{$get:function(a,b){return nArray.mateEnter(this,a,"get",b)},$search:function(a,b){return nArray.mateEnter(this,a,"search",b)},$update:function(a){return nArray.update(this,a)},$path:[]}),window.nArray=nArray});